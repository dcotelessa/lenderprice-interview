var statusArr=["New","In Progress","Completed"];angular.module("assignmentManagerApp",["assignmentManagerApp.services"]).filter("all",function(){return function(s){return s}}).filter("unassigned",function(){return function(s){return 0===s.__v}}).filter("assigned",function(){return function(s){return s.__v>0}}).filter("in_progress",function(){return function(s){return"In Progress"===this.lists.jobs.data[this.lists.jobs.indx[s]].status}}).filter("completed",function(){return function(s){return"Completed"===this.lists.jobs.data[this.lists.jobs.indx[s]].status}}).factory("listInfo",function(){var s={lists:{assignee:{data:[],indx:{},loaded:!1,cleaned:!1,expanded:null,filter:"all"},jobs:{data:[],indx:{},cleaned:!1,loaded:!1}},filter:"all"};return s}).controller("buttonsController",function(s,e,t,n,i){function a(s){var e,t={};for(var n in s)e=s[n],t[e._id]||(t[e._id]=n);return t}function o(){if(i.lists.jobs.data.length>0){var s,e,t,n={};for(e in i.lists.assignee.data){t=i.lists.assignee.data[e],n={};for(s in t.jobs)(null===t.jobs[s]||n[t.jobs[s]])&&t.jobs.splice(s,1),n[t.jobs[s]]=!0,i.lists.jobs.indx[t.jobs[s]]&&(i.lists.jobs.data[i.lists.jobs.indx[t.jobs[s]]].assigned=!0);t.__v=t.jobs.length}i.lists.assignee.cleaned=!0}}function l(){if(i.lists.jobs.data.length>0){var s,e,t,n,a={};for(n in i.lists.jobs.data)t=i.lists.jobs.data[n],a[t._id]?(i.lists.jobs.data.splice(t,1),i.lists.jobs.indx[t._id]=void 0):(s="New",t.start_date&&(s=t.end_date?"Completed":"In Progress"),t.status&&(e=t.status.split(",").pop(),statusArr.indexOf(e)>-1&&(s=e)),i.lists.jobs.data[n].status=s,a[t._id]=!0);i.lists.jobs.cleaned=!0}}s.isLoading=function(){var s=i.lists.assignee.loaded&&i.lists.jobs.loaded;return!s},s.tabClasses=function(s){return i.filter===s?"is-active":""},s.setFilter=function(s){i.filter!==s&&(i.filter=s,e.$broadcast("displayChange",i))},n.getAssignees().then(function(s){i.lists.assignee.indx=a(s),i.lists.assignee.data=s,i.lists.assignee.loaded=!0,i.lists.jobs.cleaned||l(),o(),e.$broadcast("displayChange",i)}),n.getJobs().then(function(s){i.lists.jobs.indx=a(s),i.lists.jobs.data=s,i.lists.jobs.loaded=!0,l(),i.lists.assignee.cleaned||o(),e.$broadcast("displayChange",i)})}).controller("displayController",function(s,e,t,n){s.displayData=[],s.isEmpty=function(){return s.displayData.length?"":"is-hidden"},s.setClassbyJobQuantity=function(s){var e=s>4?"job-4":"job-"+s;return e},s.tabJobClasses=function(s){return n.lists.assignee.filter===s?"is-active":""},s.setJobFilter=function(s){n.lists.assignee.filter!==s&&(n.lists.assignee.filter=s,e.$broadcast("displayChange",n))},s.uniqueName=function(s){return!s},s.jobData=function(s,e){return n.lists.jobs.data[n.lists.jobs.indx[s]][e]},s.jobStatusSort=function(s){var e=n.lists.jobs.data[n.lists.jobs.indx[s]].status;return statusArr.indexOf(e)},s.collapseItem=function(s){n.lists.assignee.expanded=null,e.$broadcast("displayChange",n)},s.expandItem=function(s){n.lists.assignee.expanded=s,e.$broadcast("displayChange",n)},s.addAssignee=function(s){console.log("addAssignee")},s.requestUpdateAssignee=function(e){s.editingAssignee=!0},s.cancelUpdateAssignee=function(e){s.editingAssignee=!1},s.updateAssignee=function(s){console.log("updateAssignee")},s.deleteAssignee=function(s){console.log("deleteAssignee")},s.addJob=function(){console.log("addJob")},s.requestAddJob=function(){s.addingJob=!0},s.cancelAddJob=function(){s.addingJob=!1},s.updateJob=function(){console.log("updateJob")},s.requestUpdateJob=function(e){s.editingJob=!0},s.cancelUpdateJob=function(e){s.editingJob=!1},s.deleteJob=function(s){console.log("deleteJob")},s.startJob=function(s){console.log("startJob")},s.unassignJob=function(s){console.log("unassignJob")},s.completeJob=function(s){console.log("completeJob")},s.$on("displayChange",function(e,n){s.addingAssignee=!1,s.editingAssignee=!1,s.addingJob=!1,s.editingJob=!1,s.selectedFilter=t(n.filter),s.selectedJobFilter=t(n.lists.assignee.filter).bind(n),s.displayData=n.lists.assignee.data,s.jobsData=n.lists.jobs.data,s.assigneeExpanded=n.lists.assignee.expanded})}),angular.module("assignmentManagerApp.services",[]).factory("amAPI",function(s,e){var t="http://interview.lenderprice.com:7070/",n=function(n){var i=n;return function(){var n=s.defer();return e.get(t+"api/"+i).then(function(s,e){n.resolve(s.data)},function(s,e){n.reject(s)}),n.promise}},i={getAssignees:n("assignee"),getJobs:n("jobs")};return i});