var statusArr=["New","In_Progress","Completed"];angular.module("assignmentManagerApp",["assignmentManagerApp.services"]).filter("all",function(){return function(s){return s}}).filter("unassigned",function(){return function(s){return 0===s.__v}}).filter("assigned",function(){return function(s){return s.__v>0}}).filter("in_progress",function(){return function(s){return"In_Progress"===this.data[this.indx[s]].status}}).filter("completed",function(){return function(s){return"Completed"===this.data[this.indx[s]].status}}).factory("listInfo",function(){var s={lists:{assignee:{data:[],indx:{},cleaned:!1,filter:"all"},jobs:{data:[],indx:{},cleaned:!1}},filter:"all",assigneesLoadedStatus:"assigneesNotLoaded",jobsStatus:"notLoaded"};return s}).controller("buttonsController",function(s,t,e,n,a){function i(s){var t,e={};for(var n in s)t=s[n],e[t._id]||(e[t._id]=n);return e}function o(){if(a.lists.jobs.data.length>0){var s,t,e,n={};for(t in a.lists.assignee.data){e=a.lists.assignee.data[t],n={};for(s in e.jobs)(null===e.jobs[s]||n[e.jobs[s]])&&e.jobs.splice(s,1),n[e.jobs[s]]=!0,a.lists.jobs.indx[e.jobs[s]]&&(a.lists.jobs.data[a.lists.jobs.indx[e.jobs[s]]].assigned=!0);e.template="displayAssignee",e.__v=e.jobs.length}a.lists.assignee.cleaned=!0}}function d(){if(a.lists.jobs.data.length>0){var s,t,e,n,i={};for(n in a.lists.jobs.data)e=a.lists.jobs.data[n],i[e._id]?(a.lists.jobs.data.splice(e,1),a.lists.jobs.indx[e._id]=void 0):(s=["New"],e.start_date&&(s=e.end_date?["Completed"]:["In_Progress"]),e.status&&(t=e.status.split(",").pop(),statusArr.indexOf(t)>-1&&(s=[t])),a.lists.jobs.data[n].status=s,i[e._id]=!0);a.lists.jobs.cleaned=!0}}s.assigneesLoadedStatus=a.assigneesLoadedStatus,s.tabClasses=function(s){return a.filter===s?"is-active":""},s.setFilter=function(s){a.filter!==s&&(a.filter=s,t.$broadcast("assigneeChange",a))},n.getAssignees().then(function(s){a.lists.assignee.indx=i(s),a.lists.assignee.data=s,a.lists.jobs.cleaned||d(),o(),a.assigneesLoadedStatus="assigneesLoaded",t.$broadcast("assigneeChange",a)}),n.getJobs().then(function(s){a.lists.jobs.indx=i(s),a.lists.jobs.data=s,d(),a.lists.assignee.cleaned||o(),a.jobsStatus="displayJobs",t.$broadcast("jobChange",a)}),s.$on("assigneeChange",function(t,e){s.assigneesLoadedStatus=e.assigneesLoadedStatus})}).controller("displayController",function(s,t,e,n,a){function i(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}s.displayData=[],s.setClassbyJobQuantity=function(s){var t=s>4?"job-4":"job-"+s;return t},s.tabJobClasses=function(s){return a.lists.assignee.filter===s?"is-active":""},s.setJobFilter=function(s){a.lists.assignee.filter!==s&&(a.lists.assignee.filter=s,t.$broadcast("jobChange",a))},s.typingName=function(s){return!s},s.jobData=function(s,t){return a.lists.jobs.data[a.lists.jobs.indx[s]][t]},s.jobStatusSort=function(s){var t=a.lists.jobs.data[a.lists.jobs.indx[s]].status;return statusArr.indexOf(t)},s.setAssigneeStatus=function(s,e){for(var n=0;n<a.lists.assignee.data.length;n++)a.lists.assignee.data[n].template="displayAssignee";a.jobsStatus="displayJobs",a.lists.assignee.data[a.lists.assignee.indx[e]].template=s,t.$broadcast("assigneeChange",a)},s.setJobsStatus=function(e,n){s.editingJob=a.lists.jobs.data[a.lists.jobs.indx[n]],s.previousStatus=s.jobsStatus,a.jobsStatus=e,s.displayData=[],t.$broadcast("assigneeChange",a)},s.addAssignee=function(t){var e={name:t};s.setAssigneeStatus("notLoaded"),n.addAssignee(e).then(function(t){s.setAssigneeStatus("displayAssignee")})},s.updateAssignee=function(s,t){console.log("updateAssignee - not now")},s.deleteAssignee=function(s){console.log("deleteAssignee - not now")},s.addJob=function(t,e){var a={name:t,description:e};s.setJobsStatus("notLoaded"),n.addJob(a).then(function(t){s.setJobsStatus(previousStatus)})},s.updateJob=function(t,e,i,o,d,r){var u={summary:e,description:i,status:a.lists.jobs.data[a.lists.jobs.indx[t]].status,startdate:a.lists.jobs.data[a.lists.jobs.indx[t]].startdate,enddate:a.lists.jobs.data[a.lists.jobs.indx[t]].enddate};a.lists.jobs.data[a.lists.jobs.indx[t]]=u,s.setJobsStatus("notLoaded"),n.updateJob(t,u).then(function(t){s.setJobsStatus(previousStatus)})},s.deleteJob=function(s){console.log("deleteJob - not now")},s.startJob=function(e){var i={summary:a.lists.jobs.data[a.lists.jobs.indx[e]].summary,description:a.lists.jobs.data[a.lists.jobs.indx[e]].description,status:["In_Progress"],startdate:Date.now(),enddate:""};a.lists.jobs.data[a.lists.jobs.indx[e]]=i,s.setJobsStatus("notLoaded"),n.updateJob(e,i).then(function(s){t.$broadcast("jobChange",a),t.$broadcast("assignChange",a)})},s.assignJob=function(t,e){var a={assignee_id:t,job_id:e};s.setJobsStatus("notLoaded"),n.assignJob(item,a).then(function(t){s.setJobsStatus(previousStatus)})},s.unassignJob=function(s){console.log("unassignJob - not now"),setJobsStatus(previousStatus)},s.completeJob=function(e){var i={summary:a.lists.jobs.data[a.lists.jobs.indx[e]].summary,description:a.lists.jobs.data[a.lists.jobs.indx[e]].description,status:["Completed"],startdate:a.lists.jobs.data[a.lists.jobs.indx[e]].startdate,enddate:Date.now()};a.lists.jobs.data[a.lists.jobs.indx[e]]=i,s.setJobsStatus("notLoaded"),n.updateJob(e,i).then(function(s){t.$broadcast("jobChange",a),t.$broadcast("assignChange",a)})},s.$on("assigneeChange",function(t,n){s.selectedAssigneeFilter=e(n.filter),s.jobsStatus=a.jobsStatus,s.displayData=n.lists.assignee.data,i()}),s.$on("jobChange",function(t,n){s.jobsData=n.lists.jobs.data,s.selectedJobFilter=e(n.lists.assignee.filter).bind(n.lists.jobs),i()})}),angular.module("assignmentManagerApp.services",[]).factory("amAPI",function(s,t){var e="http://interview.lenderprice.com:7070/",n=function(n){var a=n;return function(n){var i=s.defer();return t.post(e+"api/"+a,n).then(function(s,t){i.resolve(s.data)},function(s,t){i.reject(s)}),i.promise}},a=function(n){var a=n;return function(n,i){var o=s.defer();return t.post(e+"api/"+a+"/"+n,i).then(function(s,t){o.resolve(s.data)},function(s,t){o.reject(s)}),o.promise}},i=function(){return function(n){var a=s.defer();return t.post(e+"api/assignjob",n).then(function(s,t){a.resolve(s.data)},function(s,t){a.reject(s)}),a.promise}},o=function(n){var a=n;return function(){var n=s.defer();return t.get(e+"api/"+a).then(function(s,t){n.resolve(s.data)},function(s,t){n.reject(s)}),n.promise}},d={getAssignees:o("assignee"),getJobs:o("jobs"),updateAssignee:a("assignee"),updateJob:a("jobs"),addAssignee:n("assignee"),addJob:n("jobs"),assignJob:i()};return d});